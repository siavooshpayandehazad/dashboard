<!DOCTYPE html>

<html lang="en">
<head>
  <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>

 <title>My Journal</title>
</head>

{%if pageTheme=="Dark"%}
<body class="featured">
{% else %}
<body>
{% endif %}
<div id="overlay">
  <div style="border-radius: 20px; margin-left: 40%; margin-top: 20%;width:200px;height:70px;background-color:white; text-align: center;">
    enter your password</br>
    <input type="password" id="password"><br>
    <input type="submit" style="margin-left: 30%; margin-top: 5px;" onclick="login()">
  </div>
</div>

<script type="text/javascript">
  function login(){
    var password = document.getElementById("password").value;
     document.getElementById("password").value = "";
    $.ajax({
        type: "POST",
        url: "http://localhost:5000/home",
        data: {"password": password},
    }).success(function(result){
      if (result == "success"){
        localStorage.setItem('token',"true");
        document.getElementById("overlay").style.display = "none";
        document.getElementById("password").style.backgroundColor = "white";
      }
      else{
        document.getElementById("password").style.backgroundColor = "#fc9272";
      }
    })
  }

  function checkLoggedIn () {
    const token = localStorage.getItem('token');
    if (token === "false"){
      document.getElementById("overlay").style.display = "block";
    }
  }

  function logout(){
    document.getElementById("overlay").style.display = "block";
    localStorage.setItem('token',"false");
  }

  checkLoggedIn();
</script>

  {% with page="index" %}
    {% include "header.html" %}
  {% endwith %}

  <div>
    <!-- Header! -->
    <h1 style= "font-family:Impact;"> <font style="text-decoration: underline;"> {{ name }}</font> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    {% if PageMonth > 1  %}
      <a class= "arrow" href="/home?date={{PageYear}}-{{'%02d' % (PageMonth-1)}}">&#9668;</a>
    {% else %}
      <a class= "arrow" href="/home?date={{PageYear-1}}-{{'%02d' % (12)}}">&#9668;</a>
    {% endif %}
    {{titleDate}}
    {% if PageMonth < 12  %}
      <a class= "arrow" href="/home?date={{PageYear}}-{{'%02d' % (PageMonth+1)}}">&#9658;</a>
    {% else %}
      <a class= "arrow" href="/home?date={{PageYear+1}}-{{'%02d' % (1)}}">&#9658;</a>
    {% endif %}
    </h1>

    <div style="width:120px;float:left; margin-right:10px;margin-top:5px;">

      <div style="float:right;">
      <!-- weather widget start -->
      {%if pageTheme=="Dark"%}
        <script type='text/javascript' src='https://darksky.net/widget/default-small/55.7081,13.1973/uk12/en.js?width=100%&height=60&title=Full Forecast&textColor=d9d9d9&bgColor=transparent&transparency=true&skyColor=undefined&fontFamily=Default&customFont=&units=uk'></script>
      {%else%}
        <script type='text/javascript' src='https://darksky.net/widget/default-small/55.7081,13.1973/uk12/en.js?width=100%&height=60&title=Full Forecast&textColor=1b46ae&bgColor=transparent&transparency=true&skyColor=undefined&fontFamily=Default&customFont=&units=uk'></script>
      {%endif%}
      <!-- weather widget end -->
      </div>

    {% with counterValue = counterValue %}
        {% include "trackerModules/counter.html" %}
    {% endwith %}

    {% with days = days, highlight=highlight,today=today, activityList=activityList, monthsActivitiesPlanned=monthsActivitiesPlanned%}
        {% include "trackerModules/activityTracker.html" %}
    {% endwith %}

    {% with days = days, moods = moods, PageYear=PageYear, PageMonth=PageMonth, today=today %}
        {% include "trackerModules/moodTracker.html" %}
    {% endwith %}


    <div style="margin-left: 5px;float:left; min-width:130px;">
      {%if pageTheme=="Dark"%}
      <img src= "{{url_for('static', filename = 'page1_Large_dark.png')}}" float="right" width="110" alt="page1_Large_dark">
      {% else %}
      <img src= "{{url_for('static', filename = 'page1_Large.png')}}" float="right" width="130" alt="page1_Large">
      {% endif %}
    </div>

    <div style="width:100%; margin-left:5px;  margin-bottom: 10px; float:left; min-width:200px;">
      <div class="divider" style="width:90%; height:4px; float:left; margin-left: 3.3%; margin-top: 18px;"></div>
      <img src= "{{url_for('static', filename = 'page1_Small.png')}}" float="left" width="50px" alt="page1_Small">
    </div>

    <div style="width:45%;min-height:220px;background-color:white;margin-bottom: 20px; margin-left:3.3%;border-radius:10px;text-align:center;float:left;">
      <div style="margin-top: 10px; margin-right: 20px; width: 220px; float:right" >
        Add Work Hours: <input type="text" id="workHourVal" name="date" style="width: 50px; ">
        <i class="fa fa-check" id="submitToGraph" onclick="submitWHours()"></i>
      </div>
      <h2  class="title lightbg"  style="float:left; margin-left: 20px;">Work Hours Tracker</h2>
      <div style="float:left; width:90%; margin-left:5%">
        <canvas  height="100px" id="WHTracker"></canvas>
      </div>
    </div>

    <div style="width:100%; margin-right:5px; margin-bottom: 10px; float:left; min-width:200px;">
      <div class="divider" style="width:90%; height:4px; float:right; margin-right: 3.3%; margin-top: 18px;"></div>
      <img src= "{{url_for('static', filename = 'page1_Small.png')}}" style="transform: rotate(180deg); float:right" width="50px" alt="page1_Small">
    </div>

    <div style="width:45%;min-height:220px;background-color:white;margin-bottom: 20px; margin-left:3.3%;border-radius:10px;text-align:center;float:left;">
      <div style="margin-top: 10px; margin-right: 20px; width: 150px; float:right" >
        Weight: <input type="text" id="weightVal" name="date" style="width: 50px; ">
        <i class="fa fa-check" id="submitToGraph" onclick="submitWeight()"></i>
      </div>
      <h2  class="title lightbg"  style="float:left; margin-left: 20px;">Weight Tracker</h2>
      <div style="float:left; width:90%; margin-left:5%">
        <canvas  height="100px" id="weigthTracker"></canvas>
      </div>
    </div>

    <div style="width:45%;min-height:220px;background-color:white;margin-bottom: 20px; margin-left:3.3%;border-radius:10px;text-align:center;float:left;">
      <div style="margin-top: 10px; margin-right: 20px; width: 150px; float:right">
        <i class="fa fa-check" id="submitToGraph" onclick="submitHR()" style="float:right;" onclick="submitHR()"></i>
        <div style="float:left">
          HR Min: <input type="text" id="HRMin" style="width: 50px;">
        </div>
        <div style="float:left">
          HR Max: <input type="text" id="HRMax" style="width: 50px; ">
        </div>

      </div>
      <h2  class="title lightbg"  style="float:left; margin-left: 20px;">Heart Rate Tracker</h2>
      <div style="float:left; width:90%; margin-left:5%">
        <canvas  height="100px" id="HRTracker"></canvas>
      </div>
    </div>
</body>

<script>

var myLineChart, c = 0, label = 0, randomnum, interval;


function renderchart() {
   var ctx = document.getElementById("HRTracker").getContext('2d');
   myLineChart = new Chart(ctx, {
      type: 'line',
      data: {
         labels: {{ChartMonthDays|safe}},
         datasets: [{
            label: "HR Min",
            data: {{HR_Min|safe}},
            backgroundColor: ['rgba(0,0,0, 0)'],
            borderColor: ['rgba(33,113,181, 1)'],
            borderWidth: 2
         }, {
            label: "HR Max",
            data: {{HR_Max|safe}},
            backgroundColor: ['rgba(0,0,0, 0)'],
            borderColor: ['rgba(252,78,42, 1)'],
            borderWidth: 2
         }]
      },
      options: { scales: { yAxes: [{ ticks:{ beginAtZero: true }}]}}
   });

   var ctx = document.getElementById("weigthTracker").getContext('2d');
   myLineChart = new Chart(ctx, {
      type: 'line',
      data: {
         labels: {{ChartMonthDays|safe}},
         datasets: [{
            label: "Weight",
            data: {{monthsWeights|safe}},
            backgroundColor: ['rgba(128,205,193, 0.3)'],
            borderColor: ['rgba(53,151,143, 1)'],
            borderWidth: 2,
            spanGaps: true
         }
       ]
      },
      options: { scales: { yAxes: [{ ticks:{ suggestedMin: 60, beginAtZero: false }}]}}
   });

   var WH_BG_Colors = []
   var WH_B_Colors = []
   var monthsWorkHoursTemp = {{monthsWorkHours | safe}}
   monthsWorkHoursTemp.forEach((item, i) => {
     if(parseInt(item)<4){
       WH_BG_Colors.push('rgba(252,146,114, 1)')
       WH_B_Colors.push('rgba(203,24,29, 1)')
     }else if(parseInt(item)<6){
       WH_BG_Colors.push('rgba(254,196,79, 1)')
       WH_B_Colors.push('rgba(236,112,20, 1)')
     }else if(parseInt(item)>8){
       WH_BG_Colors.push('rgba(128,205,193, 1)')
       WH_B_Colors.push('rgba(53,151,143, 1)')
     }else{
      WH_BG_Colors.push('rgba(107,174,214, 1)')
      WH_B_Colors.push('rgba(33,113,181, 1)')
     }

   });


   var ctx = document.getElementById("WHTracker").getContext('2d');
   myLineChart = new Chart(ctx, {
      type: 'bar',
      data: {
         labels: {{ChartMonthDays|safe}},
         datasets: [{
            label: "Working Hours",
            data: {{monthsWorkHours|safe}},
            backgroundColor: WH_BG_Colors,
            borderColor: WH_B_Colors,
            borderWidth: 2,
         }
       ]
      },
      options: { scales: { yAxes: [{ticks:{suggestedMax: 10, beginAtZero: true }}]}}
   });
}

window.onload = renderchart;

function submitWHours(){
  var worHours = document.getElementById("workHourVal").value;
  $.ajax({
      type: "POST",
      url: "http://localhost:5000/home",
      data: {"tracker_type":"WorkHours", "value": worHours},
  });
  document.getElementById("workHourVal").value = "";
  renderchart()
}

function submitWeight(){
  var weight = document.getElementById("weightVal").value;
  $.ajax({
      type: "POST",
      url: "http://localhost:5000/home",
      data: {"tracker_type":"weight", "value": weight},
  });
  document.getElementById("weightVal").value = "";
  renderchart()
}

function submitHR(){
  var HRMin = document.getElementById("HRMin").value;
  var HRMax = document.getElementById("HRMax").value;
  $.ajax({
      type: "POST",
      url: "http://localhost:5000/home",
      data: {"tracker_type":"HR", "value" : HRMin + ',' + HRMax},
  });
  document.getElementById("HRMin").value = "";
  document.getElementById("HRMax").value = "";
  renderchart()
}
</script>
</html>
