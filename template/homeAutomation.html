
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link rel="stylesheet" href="/static/lib/font-awesome-4.7.0/css/font-awesome.min.css"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/homeAutomation.css') }}">
  <script src="/static/lib/Chart.min.js" charset="utf-8"></script>
  <script src="/static/lib/jquery.min.js" charset="utf-8"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <title>My Journal</title>
</head>

<script type="text/javascript">
const zeroPad = (num, places) => String(num).padStart(places, '0')
tempData = {{daily_data|safe}}

function moveDay(delta){
  date = new Date(parseInt("{{PageYear}}"), parseInt("{{PageMonth}}")-1, parseInt("{{day}}"), 0, 0, 0);
  date.setDate(date.getDate() + delta);
  var dd = date.getDate();
  var mm = date.getMonth()+1; //January is 0!`
  var yyyy = date.getFullYear();
  window.location.href = "/homeAutomation?date="+zeroPad(yyyy, 2)+"-"+zeroPad(mm, 2)+"-"+zeroPad(dd, 2);
}

function drawGauge(gauge, dataset, unit, MinVal, MaxVal, bgc_cold, bgc_warm, tc_cold, tc_warm){
  lastVal = Math.round(dataset[dataset.length-1] * 100) / 100;

  if (lastVal > MaxVal){
    console.log("value over max!", lastVal);
    return;
  }
  if (lastVal < MinVal){
    console.log("value bellow min!", lastVal);
    return;
  }

  var minOfDay = MaxVal
  var maxOfDay = MinVal
  for (var i=0; i<= dataset.length; i++){
    if (minOfDay > dataset[i]){
      minOfDay = dataset[i]
    }
    if (maxOfDay < dataset[i]){
      maxOfDay = dataset[i]
    }
  }
  minOfDay = Math.round(minOfDay * 10) / 10
  maxOfDay = Math.round(maxOfDay * 10) / 10

  numberOfTicks = 20;

  ratio = (lastVal-MinVal)/MaxVal;

  r = ratio*(bgc_warm[0]-bgc_cold[0])+bgc_cold[0]
  g = ratio*(bgc_warm[1]-bgc_cold[1])+bgc_cold[1]
  b = ratio*(bgc_warm[2]-bgc_cold[2])+bgc_cold[2]

  gauge.style.backgroundColor = "rgb("+r+","+g+","+b+")"

  r = ratio*(tc_cold[0]-tc_warm[0])+tc_warm[0]
  g = ratio*(tc_cold[1]-tc_warm[1])+tc_warm[1]
  b = ratio*(tc_cold[2]-tc_warm[2])+tc_warm[2]

  ValDiv = document.createElement("div")
  ValDiv.style.color     = "rgb("+r+","+g+","+b+")";
  ValDiv.style.width     = "100%";
  ValDiv.style.left      = "10px";
  ValDiv.style.bottom    = "20px";
  ValDiv.style.position  = "absolute";
  ValDiv.style.fontSize  = "40px";
  Val = document.createElement("span")
  Val.textContent = lastVal + unit;
  ValDiv.appendChild(Val)
  gauge.appendChild(ValDiv)

  minValDiv = document.createElement("div")
  minValDiv.style.color     = "rgb("+r+","+g+","+b+")";
  minValDiv.style.width     = "100%";
  minValDiv.style.left      = "150px";
  minValDiv.style.bottom    = "65px";
  minValDiv.style.position  = "absolute";
  minValDiv.style.fontSize  = "23px";
  minVal = document.createElement("span")
  minVal.textContent = '⇂ ' + minOfDay + unit;
  minValDiv.appendChild(minVal)
  gauge.appendChild(minValDiv)

  maxValDiv = document.createElement("div")
  maxValDiv.style.color     = "rgb("+r+","+g+","+b+")";
  maxValDiv.style.width     = "100%";
  maxValDiv.style.left      = "150px";
  maxValDiv.style.bottom    = "100px";
  maxValDiv.style.position  = "absolute";
  maxValDiv.style.fontSize  = "23px";
  maxVal = document.createElement("span")
  maxVal.innerHTML = '↿ ' + maxOfDay + unit;
  maxValDiv.appendChild(maxVal)
  gauge.appendChild(maxValDiv)

}

</script>

{%if pageTheme=="Dark"%}
  <body class="featured">
{% else %}
  <body>
{% endif %}

<div class="container-fluid" style="background-color:black">

{% include "trackerModules/graphFuncs.html" %}

{% with page="homeAutomation" %}
    {% include "generic_modules/header.html" %}
{% endwith %}

<div class="row">
  <div class="col">
    <div style="float:left; width:100%;">
      <h2 class="title journal" style="margin-left:40%">
        <a class= "arrow hover-red"  onclick="moveDay(-1)">&#9668;</a>
        {{PageYear}}-{{'%02d' % (PageMonth)}}-{{'%02d' % (day)}}
        <a class= "arrow hover-red"  onclick="moveDay(1)">&#9658;</a>
      </h2>
    </div>
  </div>
</div>

  {% for item in daily_data %}
      <h3 style="margin-left: 3%; color:white;">Room {{loop.index}}</h3>

      {% with room=loop.index%}
        {% include "homeAutomation_modules/roomGauge.html" %}
      {% endwith %}

      {% with dir="left" %}
        {% include "generic_modules/divider.html" %}
      {% endwith %}
  {%endfor%}

</div>


<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

</body>

<script type="text/javascript">
gauge_1_1 = document.getElementById("tempGauge_1")
gauge_1_2 = document.getElementById("humidityGauge_1")
gauge_1_3 = document.getElementById("pressureGauge_1")
drawGauge(gauge_1_1, tempData[1]["temp"], "°C", 0, 100, [231,225,239], [152,0,67], [236, 231, 242], [4, 90, 141]);
drawGauge(gauge_1_2, tempData[1]["humidity"], "%", 0, 100, [198,219,239], [8,81,156], [240,240,240], [240,240,240]);
drawGauge(gauge_1_3, tempData[1]["pressure"], "bar", 0, 2, [0,0,0], [217,217,217], [240,240,240], [240,240,240]);

gauge_2_1 = document.getElementById("tempGauge_2")
gauge_2_2 = document.getElementById("humidityGauge_2")
gauge_2_3 = document.getElementById("pressureGauge_2")
drawGauge(gauge_2_1, tempData[2]["temp"], "°C", 0, 100, [231,225,239], [152,0,67], [236, 231, 242], [4, 90, 141]);
drawGauge(gauge_2_2, tempData[2]["humidity"], "%", 0, 100, [198,219,239], [8,81,156], [240,240,240], [240,240,240]);
drawGauge(gauge_2_3, tempData[2]["pressure"], "bar", 0, 2, [0,0,0], [217,217,217], [240,240,240], [240,240,240]);

gauge_3_1 = document.getElementById("tempGauge_3")
gauge_3_2 = document.getElementById("humidityGauge_3")
gauge_3_3 = document.getElementById("pressureGauge_3")
drawGauge(gauge_3_1, tempData[3]["temp"], "°C", 0, 100, [231,225,239], [152,0,67], [236, 231, 242], [4, 90, 141]);
drawGauge(gauge_3_2, tempData[3]["humidity"], "%", 0, 100, [198,219,239], [8,81,156], [240,240,240], [240,240,240]);
drawGauge(gauge_3_3, tempData[3]["pressure"], "bar", 0, 2, [0,0,0], [217,217,217], [240,240,240], [240,240,240]);
</script>
</html>
