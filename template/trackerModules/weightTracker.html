<script type="text/javascript">
var weights= {{monthsWeights|safe}};
var avgWeights = calculateAvg(weights);

function renderWeightTrackerChart(){
  var ctx = document.getElementById("weigthTracker").getContext('2d');

  var WeightLineChart = new Chart(ctx, {
     type: 'line',
     data: {
        labels: {{ChartMonthDays|safe}},
        datasets: [{
          label: "Avg. weight",
          type: 'line',
          data: avgWeights,
          backgroundColor: ['rgba(239,59,44, 0)'],
          borderColor: ['rgba(239,59,44, 1)'],
          borderDash: [3,5],
          borderWidth: 3,
          spanGaps: true,
          pointRadius: 2,
          pointStyle: 'dash',
       },{
           label: "Weight (kg)",
           data: weights,
           backgroundColor: ['rgba(128,205,193, 0.3)'],
           borderColor: ['rgba(53,151,143, 1)'],
           borderWidth: 2,
           spanGaps: true,
           pointStyle: 'cicle',
        }
      ]
     },
     options: { legend: {labels: {usePointStyle: true}},
                scales: { yAxes: [{ ticks:{ suggestedMin: 60, beginAtZero: false }}]},
                onClick: function(event, array){
                    if (isNaN(this.scales['y-axis-0'].getValueForPixel(event.layerY)) ||
                       (this.scales['y-axis-0'].getValueForPixel(event.layerY)+1 > this.scales['y-axis-0'].end)){
                      return;
                    }
                    var selectedDay = this.scales['x-axis-0'].getValueForPixel(event.layerX)+1;
                    var selectedVal =  weights[selectedDay-1]
                    var newVal = window.prompt("Update weigtht for day " + selectedDay + "?", selectedVal);
                    if (isNaN(newVal) || (newVal===null)){return;}
                    var date = {{PageYear}}+"-"+zeroPad({{'%02d'%PageMonth}}, 2)+"-"+zeroPad(selectedDay,2);
                    // submit new value
                    $.ajax({
                        type: "POST",
                        url: "http://localhost:5000/home",
                        data: {"tracker_type":"weight", "value": newVal, "date": date},
                    });
                    //update the step value
                    weights[selectedDay-1] = parseFloat(newVal);
                    newAvg = calculateAvg(weights);
                    for(var i = 0; i < newAvg.length; i++ ){
                      avgWeights[i] = newAvg[i];
                    }
                    this.update();
                  }
              },
      lineAtIndex: todayLineInChart(),
      lineAtIndexColor: ['rgba(53,151,143, 1)'],
  });
}

</script>

<div class="graphCard">
  <h2  class="title lightbg"  style="float:left; margin-left: 20px;">Weight Tracker</h2>
  <div style="float:left; width:90%; margin-left:5%">
    <canvas  height="100px" id="weigthTracker"></canvas>
  </div>
</div>
